\section{Task}

\subsection{Software Development}

\subsubsection{Program versions}
\label{sec:tasks:versions}

This task consists of the development of different sequential versions
of the described application using C++20. Please, note that no use of
multi-threading or parallelism is allowed.

To develop the required program teams may consider different alternatives
as using structures of arrays, arrays of structures or hybrid alternatives
combining both approaches.

\subsubsection{Components}

The following components shall be developed:

\begin{itemize}
  \item \cppid{sim}: 
        Library with all components used from main program.

  \item \cppid{utest}: 
        Unit tests of all components in library \cppid{sim}.

  \item \cppid{ftest}:
        Functional tests of the application.

  \item \cppid{fluid}: 
        Executable program with the application.

\end{itemize}

Below, some components are described in more detail:

\paragraph{sim}: Simulation library components.

It will contain, at least, the following source files:
\begin{itemize}
  \item \cppid{progargs.hpp, progargs.cpp}: 
        Argument handling for \cppid{main()} parameters. 
  \item \cppid{grid.hpp, grid.cpp}: 
        Grid representation.
  \item \cppid{block.hpp, block.cpp}: 
        Block representation.
\end{itemize}

\paragraph{utest}: Unit tests.

It will contain, at least, the following source files:
\begin{itemize}
  \item \cppid{progargs\_test.cpp}: 
        Unit tests for \cppid{progargs}.
  \item \cppid{grid\_test.cpp}:
        Unit tests for \cppid{grid}.
  \item \cppid{block\_test.cpp}:
        Unit tests for \cppid{block}.
\end{itemize}

\paragraph{fluid}: Program with the application.

It will contain a single source file:
\begin{itemize}
  \item \cppid{fluid.cpp}: 
        It shall only contain a \cppid{main()} function for the application.
        It shall not include any additional function.
\end{itemize}

\subsubsection{Compiling the project}

All source files must compile without problems and shall not emit any compiler warning.
A CMake configuration file shall be included with the following options:

\begin{lstlisting}[title={CmakeLists.txt},frame=single]
cmake_minimum_required(VERSION 3.26)
project(image LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS_OFF)
add_compile_options(-Wall -Wextra -Werror -pedantic -pedantic-errors)

set(CMAKE_CXX_FLAGS_RELEASE "-march=native")

add_subdirectory(sim)
add_library(common file1-common.cpp file2-common.cpp file3-common.cpp)
add_library(aos file1-aosd.cpp file2-aos.cpp)
add_library(aos file1-aosd.cpp file2-aos.cpp)

add_executable(fluidaos fluidaos.cpp)
target_link_libraries(fluidaos common fluidaos)
add_executable(fluidsoa fluidsoa.cpp)
target_link_libraries(fluidsoa common fluidsoa)
\end{lstlisting}

The CMake configuration file for directory \cppid{sim} shall include the
following options:

\begin{lstlisting}[title={Library sim CmakeLists.txt},frame=single]
add_library(sim file1.cpp file2.cpp file3.cpp)
target_include_directories(sim PUBLIC ..)
\end{lstlisting}

The CMake configuration file for directory \cppid{fluid} shall include the
following options:

\begin{lstlisting}[title={Program fluid CmakeLists.txt},frame=single]
add_executable(fluid fluid.cpp)
target_link_libraries(fluid sim)
target_include_directories(fluid PUBLIC ../common)
\end{lstlisting}

This rules are an example. 

Keep in mind that all evaluations shall be performed with the compiler optimizations
enabled with CMake option
\cppid{-DCMAKE\_BUILD\_TYPE=Release}.

\textbad{IMPORTANT}: 
The only allowed library is the C++ standard library.
No external library is allowed.

\textbad{EXCEPTION}: The C++ Core Guidelines Support Library (commonly referred as
the \cppid{GSL}) is also allowed. The latest version can be obtained at:
\url{https://github.com/microsoft/GSL}.

\subsubsection{Code quality rules}

Source code must be well structured and organized, 
as well as appropriately documented.
The \textemph{C++ Core Guidelines}
(\url{http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines})
are recommended but not fully required.

A set of rules will be published in a separate document.

\subsubsection{Unit tests}

A set of unit tests shall be defined and included in the submission.
You are recommended, but not required, to make use of GoogleTest
(\url{https://github.com/google/googletest}).

In any case, evidence of enough unit tests shall be included in the
submission.

\subsubsection{Use of AI tools}

The use of AI powered tools during the project is allowed. However, please
keep in mind the following:

\begin{itemize}

\item If you use any AI tool, please declare such uses in the design section
of your project report. No negative grading will be given to such uses, provided
that they are declared in the project report.

\item No support will be given to the use of such tools. In particular, if you
have questions about code, you need to be able to explain your own code.

\item Beware that some AI tools may generate unsafe code or code with poor 
performance.

\item You may be required by any of your instructors to explain your own code.


\end{itemize}

\subsection{Performance and energy evaluation}

This task consists of a performance evaluation of the application.
To conduct the performance evaluation, the total execution time shall be measured.
In addition, energy use must be also measured.
The power use must be derived.

All performance evaluations shall be performed in a node from the
\cppid{avignon} cluster.

Represent in a graphic all total execution times, energy use and power
for images with different number of iterations.

\textbf{The project report shall include conclusions drawn from results}.
Please, do not limit to simply describing data.
Try to find convincing explanations of those results.

