\section{Task}

\subsection{Software Development}

\subsubsection{Program versions}
\label{sec:tasks:versions}

This task consists of the development of different sequential versions
of the described application using C++20. Please, note that no use of
multi-threading or parallelism is allowed.

The following versions of the program will be prepared:
\begin{itemize}
\item \textmark{fluidsoa}: Structures of arrays with internal computations
using double precision for floating point.
\item \textmark{fluidaos}: Arrays of structures with internal computations
using double precision for floating point.
\end{itemize}

The strategies for SOA versus AOS will be as follows:

\begin{itemize}
  \item \textmark{SOA -- Structure of Arrays}:
        A grid block will contain one independent array (or vector) for
        each data item in a particle
  \item \textmark{AOS -- Array of Structures}:
        A grid block will contain a single array (or vector) of particle objects.
\end{itemize}

\subsubsection{Components}

The following components shall be developed:

\begin{itemize}
  \item \cppid{common}: 
        Library with source files that are common to all versions.
        When needed components may be generic on the floating point type by using
        templates.

  \item \cppid{soa}: 
        Library with source files that are specific to the \textmark{SOA} version.
        When needed components may be generic on the floating point type by using
        templates.

  \item \cppid{aos}:
        Library with source files that are specific to the \textmark{AOS} version.
        When needed components may be generic on the floating point type by using
        templates.

  \item \cppid{fluidsoa}: 
        Executable program with the \textmark{soa} version.

  \item \cppid{fluidaos}: 
        Executable program with the \textmark{aos} version.


\end{itemize}

Below, components are described in more detail:

\paragraph{common}: Common components:

It will contain, at least, the following source files:
\begin{itemize}
  \item \cppid{progargs.cpp}: 
        Argument handling for \cppid{main} parameters. 
\end{itemize}

\paragraph{soa}: Components library for \textmark{SOA}.

It will contain, at least, the following source files:
\begin{itemize}
  \item \cppid{gridsoa.cpp}: 
        Grid representation for \textmark{SOA} representation.
  \item \cppid{blocksoa.cpp}: 
        Block element for \textmark{SOA} representation.
\end{itemize}

\paragraph{aos}: Components library for \textmark{AOS}.

It will contain, at least, the following source files:
\begin{itemize}
  \item \cppid{gridaos.cpp}: 
        Grid representation for \textmark{AOS} representation.
  \item \cppid{blockaos.cpp}: 
        Block element for \textmark{AOS} representation.
\end{itemize}

\paragraph{fluidsoa}: Program with \textmark{soa} version.

It will contain a single source file:
\begin{itemize}
  \item \cppid{fluidsoa.cpp}: 
        It shall only contain a \cppid{main()} function for this version.
        It shall not include any additional function.
\end{itemize}

\paragraph{fluidaos}: Program with \textmark{aos} version.

It will contain a single source file:
\begin{itemize}
  \item \cppid{fluidaos.cpp}: 
        It shall only contain a \cppid{main()} function for this version.
        It shall not include any additional function.
\end{itemize}

\subsubsection{Compiling the project}

All source files must compile without problems and shall no emit no compiler warning.
A CMake configuration file shall be included with the following options:

\begin{lstlisting}[title={CmakeLists.txt},frame=single]
cmake_minimum_required(VERSION 3.26)
project(image LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS_OFF)
add_compile_options(-Wall -Wextra -Werror -pedantic -pedantic-errors)

set(CMAKE_CXX_FLAGS_RELEASE "-march=native")

add_library(common file1-common.cpp file2-common.cpp file3-common.cpp)
add_library(aos file1-aosd.cpp file2-aos.cpp)
add_library(aos file1-aosd.cpp file2-aos.cpp)

add_executable(fluidaos fluidaos.cpp)
target_link_libraries(fluidaos common fluidaos)
add_executable(fluidsoa fluidsoa.cpp)
target_link_libraries(fluidsoa common fluidsoa)
\end{lstlisting}

This rules are an example. Keep in mind the following:

\begin{itemize}

  \item The library \cppkey{common} consists of all the \cppid{.cpp} files
        that are considered needed (names of choice by designers) and
        which offer common functionality to both versions of the program.

  \item The library \cppkey{aos} consists of all the \cppid{.cpp} files
        that are considered needed (names of choice by designers) and
        which offer functionality which is exclusive of the
        \textemph{array of structures} implementation.

  \item The same idea applies to the rest of libraries.

\end{itemize}

Note that generic components (with \cppkey{template}) are header only components and
are not included in any library.

Keep in mind that all evaluations shall be performed with the compiler optimizations
enabled with CMake option
\cppid{-DCMAKE\_BUILD\_TYPE=Release}.

\textbad{Important}: 
The only allowed library is the C++ standard library.
No external library is allowed.

\textbad{Exception}: The C++ Core Guidelines Support Library (commonly referred as
the \cppid{GSL}) is also allowed. The latest version can be obtained at:
\url{https://github.com/microsoft/GSL}.

\subsubsection{Code quality rules}

Source code must be well structured and organized, 
as well as appropriately documented.
The \textemph{C++ Core Guidelines}
(\url{http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines})
are recommended but not fully required.

A set of rules will be published in a separate document.

\subsubsection{Unit tests}

A set of unit tests shall be defined and included in the submission.
You are recommended, but not required, to make use of GoogleTest
(\url{https://github.com/google/googletest}).

In any case, evidence of enough unit tests shall be included in the
submission.

\subsubsection{Use of AI tools}

The use of AI powered tools during the project is allowed. However, please
keep in mind the following:

\begin{itemize}

\item If you use any AI tool, please declare such uses in the design section
of your project report. No negative grading will be given to such uses, provided
that they are declared in the project report.

\item No support will be given to the use of such tools. In particular, if you
have questions about code, you need to be able to explain your own code.

\item Beware that some AI tools may generate unsafe code or code with poor 
performance.

\item You may be required by any of your instructors to explain your own code.


\end{itemize}

\subsection{Performance and energy evaluation}

This task consists of a comparative performance evaluation of the 
different implementation strategies.

To conduct the performance evaluation, the total execution time shall be measured.
In addition, energy use must be also measured.
The power use must be derived.

All performance evaluations shall be performed in a node from the
\cppid{avignon} cluster.

Represent in a graphic all total execution times, energy use and power
for images with different number of iterations.

\textbf{The project report shall include conclusions drawn from results}.
Please, do not limit to simply describing data.
Try to find convincing explanations of those results.

